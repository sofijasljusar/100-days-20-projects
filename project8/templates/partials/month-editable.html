{% load static %}

{% include 'partials/month-habits.html' %}

{% include 'partials/habit-modal.html' %}

<script>
  document.querySelectorAll('.habit-cell').forEach(cell => {
    cell.addEventListener('click', async () => {
      const habitId = cell.dataset.habit;
      const dateStr = cell.dataset.date; // YYYY-MM-DD string
      const [year, month, day] = dateStr.split('-');

      const response = await fetch(`/toggle-habit/${habitId}/${year}/${month}/${day}/`, {
        method: 'POST',
        headers: {
          'X-CSRFToken': '{{ csrf_token }}',
        },
      });

      if (response.ok) {
        const result = await response.json();
        if (result.status === 'created') {
          cell.classList.remove('bg-light');
          cell.classList.add('bg-info', 'text-white');
        } else if (result.status === 'deleted') {
          cell.classList.remove('bg-info', 'text-white');
          cell.classList.add('bg-light');
        }
      }
    });
  });
</script>

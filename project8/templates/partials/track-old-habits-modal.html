<div class="modal fade" id="trackOldHabitsModal" tabindex="-1" aria-labelledby="trackOldHabitsModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
        <form id="oldHabitsForm" method="post" action="{% url 'old_habits' %}">
            {% csrf_token %}
            <div class="modal-header">
              <h5 class="modal-title" id="trackOldHabitsModalLabel">Scroll and select...</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
    
            <div class="modal-body">
              <div class="scrollable-container d-flex flex-column gap-3" style="height: 100px">
                <div id="existingHabitsContainer" class="w-100 d-flex flex-column gap-3">
                  <!-- Habits will be loaded here via AJAX -->
                </div>
              </div>
            </div>
    
            <div class="modal-footer">
              <button type="submit" class="btn btn-outline-dark">Save</button>
            </div>
        </form>    
    </div>
  </div>
</div>
<script>
document.getElementById('trackOldHabitsModal').addEventListener('show.bs.modal', function () {
    const container = document.getElementById('existingHabitsContainer');
    container.innerHTML = '<p>Loading...</p>';

    fetch("{% url 'old_habits' %}")
        .then(response => response.json())
        .then(data => {
            container.innerHTML = '';
            if (data.habits.length === 0) {
                container.innerHTML = '<p class="text-muted">All your habits have been tracked this month!</p>';
            } else {
                data.habits.forEach(habit => {
                    const btn = document.createElement('button');
                    btn.type = 'button';
                    btn.className = 'btn btn-outline-dark w-100';
                    btn.textContent = habit.name;
                    
                    // Hidden input (added when selected)
                    let input = null;
                    btn.addEventListener('click', () => {
                        btn.classList.toggle('btn-outline-dark');
                        btn.classList.toggle('btn-dark');

                        if (!input) {
                            input = document.createElement('input');
                            input.type = 'hidden';
                            input.name = 'habits';
                            input.value = habit.id;
                            document.getElementById('oldHabitsForm').appendChild(input);
                        } else {
                            input.remove();
                            input = null;
                        }
                    });
                    container.appendChild(btn);
                });
            }
        });
});
</script>

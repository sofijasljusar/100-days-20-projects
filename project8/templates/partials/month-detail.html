{% load static %}

<div class="bg-white bg-card w-100 h-100 text-center py-5">
  <h3 class="text-shadow">{{ month_start|date:"F" }} {{ month_start|date:"Y" }}</h3>
  <div class="mb-4">
    <button class="btn border-dark" data-bs-toggle="modal" data-bs-target="#addHabitModal">Create a New Habit :D</button>
  </div>

  <div class="row g-3 scrollable-container">
    {% for habit in habits %}
      {% include 'partials/habit-item.html' with habit=habit %}
    {% endfor %}
  </div>
</div>

{% include 'partials/habit-modal.html' %}

<script>
  document.querySelectorAll('.habit-cell').forEach(cell => {
    cell.addEventListener('click', async () => {
      const habitId = cell.dataset.habit;
      const dateStr = cell.dataset.date; // YYYY-MM-DD string
      const [year, month, day] = dateStr.split('-');

      const response = await fetch(`/toggle-habit/${habitId}/${year}/${month}/${day}/`, {
        method: 'POST',
        headers: {
          'X-CSRFToken': '{{ csrf_token }}',
        },
      });

      if (response.ok) {
        const result = await response.json();
        if (result.status === 'created') {
          cell.classList.remove('bg-light');
          cell.classList.add('bg-info', 'text-white');
        } else if (result.status === 'deleted') {
          cell.classList.remove('bg-info', 'text-white');
          cell.classList.add('bg-light');
        }
      }
    });
  });
</script>
